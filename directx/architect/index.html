



<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="工作、编程记录">
      
      
      
        <meta name="author" content="李健宽">
      
      
        <meta name="lang:clipboard.copy" content="复制">
      
        <meta name="lang:clipboard.copied" content="已复制">
      
        <meta name="lang:search.language" content="ja">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="没有找到符合条件的结果">
      
        <meta name="lang:search.result.one" content="找到 1 个符合条件的结果">
      
        <meta name="lang:search.result.other" content="# 个符合条件的结果">
      
        <meta name="lang:search.tokenizer" content="[\uff0c\u3002]+">
      
      <link rel="shortcut icon" href="../../assets/images/code.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.1.2">
    
    
      
        <title>DirectML 工作流 - Studio</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.3020aac5.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/application-palette.224b79ff.css">
      
      
        
        
        <meta name="theme-color" content="#ff7043">
      
    
    
      <script src="../../assets/javascripts/modernizr.01ccdecf.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noto+Serif+SC:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Noto Serif SC","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
    
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="deep-orange" data-md-color-accent="amber">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#directml" tabindex="1" class="md-skip">
        跳转至
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../.." title="Studio" class="md-header-nav__button md-logo">
          
            <img src="../../assets/images/logo.svg" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Studio
            </span>
            <span class="md-header-nav__topic">
              DirectML 工作流
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            键入以开始搜索
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
        

  

<nav class="md-tabs md-tabs--active" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  <li class="md-tabs__item">
    
      <a href="../.." title="Home" class="md-tabs__link">
        Home
      </a>
    
  </li>

      
        
      
        
      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../" title="DirectX 12" class="md-tabs__link md-tabs__link--active">
          DirectX 12
        </a>
      
    </li>
  

      
    </ul>
  </div>
</nav>
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../.." title="Studio" class="md-nav__button md-logo">
      
        <img src="../../assets/images/logo.svg" width="48" height="48">
      
    </a>
    Studio
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../github-project-boards/" title="组内敏捷开发说明" class="md-nav__link">
      组内敏捷开发说明
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../design-pattern/" title="观察者模式" class="md-nav__link">
      观察者模式
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4" checked>
    
    <label class="md-nav__link" for="nav-4">
      DirectX 12
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        DirectX 12
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../" title="扉页" class="md-nav__link">
      扉页
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../directml/" title="DirectML 指南" class="md-nav__link">
      DirectML 指南
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        DirectML 工作流
      </label>
    
    <a href="./" title="DirectML 工作流" class="md-nav__link md-nav__link--active">
      DirectML 工作流
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">目录</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" title="初始化" class="md-nav__link">
    初始化
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#direct3d-12" title="初始化 Direct3D 12 资源" class="md-nav__link">
    初始化 Direct3D 12 资源
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#directml_1" title="初始化 DirectML 资源" class="md-nav__link">
    初始化 DirectML 资源
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#directml-operator" title="初始化 DirectML Operator" class="md-nav__link">
    初始化 DirectML Operator
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_2" title="载入权重参数（官方文档将此放进执行步骤）" class="md-nav__link">
    载入权重参数（官方文档将此放进执行步骤）
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" title="执行" class="md-nav__link">
    执行
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#input-output" title="绑定 Input/ Output" class="md-nav__link">
    绑定 Input/ Output
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#directml-operator_1" title="执行 DirectML Operator" class="md-nav__link">
    执行 DirectML Operator
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" title="细节" class="md-nav__link">
    细节
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#directml_2" title="初始化 DirectML 资源" class="md-nav__link">
    初始化 DirectML 资源
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../binding/" title="资源绑定" class="md-nav__link">
      资源绑定
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">目录</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" title="初始化" class="md-nav__link">
    初始化
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#direct3d-12" title="初始化 Direct3D 12 资源" class="md-nav__link">
    初始化 Direct3D 12 资源
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#directml_1" title="初始化 DirectML 资源" class="md-nav__link">
    初始化 DirectML 资源
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#directml-operator" title="初始化 DirectML Operator" class="md-nav__link">
    初始化 DirectML Operator
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_2" title="载入权重参数（官方文档将此放进执行步骤）" class="md-nav__link">
    载入权重参数（官方文档将此放进执行步骤）
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" title="执行" class="md-nav__link">
    执行
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#input-output" title="绑定 Input/ Output" class="md-nav__link">
    绑定 Input/ Output
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#directml-operator_1" title="执行 DirectML Operator" class="md-nav__link">
    执行 DirectML Operator
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" title="细节" class="md-nav__link">
    细节
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#directml_2" title="初始化 DirectML 资源" class="md-nav__link">
    初始化 DirectML 资源
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="directml">DirectML 工作流</h1>
<h2 id="_1">初始化</h2>
<h3 id="direct3d-12">初始化 Direct3D 12 资源</h3>
<ul>
<li>Direct3D 12 device</li>
<li>command queue</li>
<li>command list</li>
<li>descriptor heaps.</li>
</ul>
<h3 id="directml_1">初始化 DirectML 资源</h3>
<ul>
<li>Since you're doing machine learning inferencing as well as your rendering workload, create DirectML resources—the DirectML device, and operator instances. If you have a machine learning model where you need to perform a particular type of convolution with a particular size of filter tensor with a particular data type, then those are all parameters into DirectML's convolution operator.</li>
</ul>
<h3 id="directml-operator">初始化 DirectML Operator</h3>
<ul>
<li>DirectML records work into Direct3D 12 command lists. So, once initialization is done, you record the binding and initialization of (for example) your convolution operator into your command list. Then, close and execute your command list on your queue as usual.</li>
</ul>
<h3 id="_2">载入权重参数（官方文档将此放进执行步骤）</h3>
<ul>
<li>Upload your weight tensors into resources. A tensor in DirectML is represented using a regular Direct3D 12 resource. For example, if you want to upload your weight data to the GPU, then you do that the same way you would with any other Direct3D 12 resource (use an upload heap, or the copy queue).</li>
</ul>
<h2 id="_3">执行</h2>
<h3 id="input-output">绑定 Input/ Output</h3>
<ul>
<li>Next, you need to bind those Direct3D 12 resources as your input and output tensors. Record into your command list the binding and the execution of your operators.</li>
</ul>
<h3 id="directml-operator_1">执行 DirectML Operator</h3>
<ul>
<li>Close and execute your command list.</li>
</ul>
<h2 id="_4">细节</h2>
<ul>
<li>初始化 Direct3D 12 资源</li>
</ul>
<div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">D3D12Context</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="n">D3D12Context</span><span class="p">();</span>
  <span class="o">~</span><span class="n">D3D12Context</span><span class="p">();</span>
  <span class="kt">void</span> <span class="nf">InitD3d12</span><span class="p">();</span>
  <span class="kt">void</span> <span class="nf">InitDml</span><span class="p">();</span>
  <span class="kt">void</span> <span class="nf">CloseExecuteResetWait</span><span class="p">();</span>

 <span class="k">private</span><span class="o">:</span>
  <span class="n">com_ptr</span><span class="o">&lt;</span><span class="n">ID3D12Device</span><span class="o">&gt;</span> <span class="n">d3d12_device_</span><span class="p">;</span>
  <span class="n">com_ptr</span><span class="o">&lt;</span><span class="n">ID3D12CommandQueue</span><span class="o">&gt;</span> <span class="n">command_queue_</span><span class="p">;</span>
  <span class="n">com_ptr</span><span class="o">&lt;</span><span class="n">ID3D12CommandAllocator</span><span class="o">&gt;</span> <span class="n">command_allocator_</span><span class="p">;</span>
  <span class="n">com_ptr</span><span class="o">&lt;</span><span class="n">ID3D12GraphicsCommandList</span><span class="o">&gt;</span> <span class="n">command_list_</span><span class="p">;</span>
  <span class="n">com_ptr</span><span class="o">&lt;</span><span class="n">IDMLDevice</span><span class="o">&gt;</span> <span class="n">dml_device_</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>


<h2 id="directml_2">初始化 DirectML 资源</h2>
<div class="codehilite"><pre><span></span><span class="p">...</span>
<span class="k">class</span> <span class="nc">BaseDmlOperator</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="n">BaseDmlOperator</span><span class="p">(</span><span class="n">DML_OPERATOR_DESC</span> <span class="n">desc</span><span class="p">)</span> <span class="o">:</span> <span class="n">desc_</span><span class="p">(</span><span class="n">desc</span><span class="p">){}</span>
  <span class="o">~</span><span class="n">BaseDmlOperator</span><span class="p">();</span>

  <span class="kt">void</span> <span class="nf">Init</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">D3D12Context</span><span class="o">&gt;</span> <span class="n">p_context</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">CreateOperator</span><span class="p">(</span><span class="n">p_context</span><span class="p">);</span>
    <span class="n">CreateDescriptorHeap</span><span class="p">(</span><span class="n">p_context</span><span class="p">);</span>
    <span class="n">CreateBindingTable</span><span class="p">(</span><span class="n">p_context</span><span class="p">);</span>
    <span class="n">InitOperator</span><span class="p">(</span><span class="n">p_context</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="p">...</span>
<span class="p">}</span>
</pre></div>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../directml/" title="DirectML 指南" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  后退
                </span>
                DirectML 指南
              </span>
            </div>
          </a>
        
        
          <a href="../binding/" title="资源绑定" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  前进
                </span>
                资源绑定
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2019 lijiankuan
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.267712eb.js"></script>
      
        
        
          
          <script src="../../assets/javascripts/lunr/lunr.stemmer.support.js"></script>
          
            
              
                <script src="../../assets/javascripts/lunr/tinyseg.js"></script>
              
              
                <script src="../../assets/javascripts/lunr/lunr.ja.js"></script>
              
            
          
          
        
      
      <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script>
      
    
  </body>
</html>